# values.yaml — параметры развёртывания ClickHouse
# Все значения здесь могут быть переопределены через helm install --set или через отдельный values-файл

# Параметры образа ClickHouse
clickhouse:
  image:
    # Репозиторий образа ClickHouse (официальный образ с Docker Hub)
    repository: clickhouse/clickhouse-server
    # Тег образа (версия ClickHouse)
    tag: "24.1.1-alpine"
    # Политика загрузки образа
    pullPolicy: IfNotPresent

# Параметры Deployment
replicaCount: 1

# Ресурсы контейнера ClickHouse (запросы и лимиты)
resources:
  requests:
    # CPU запрашиваемый при запуске контейнера
    cpu: 100m
    # Память запрашиваемая при запуске контейнера
    memory: 512Mi
  limits:
    # CPU максимальный лимит для контейнера
    cpu: 2000m
    # Память максимальный лимит для контейнера
    memory: 2Gi

# Параметры хранилища
storage:
  # Размер PersistentVolumeClaim для данных ClickHouse
  size: 10Gi
  # Класс хранилища (должен существовать в кластере K8s)
  storageClassName: standard

# Параметры Service для доступа к ClickHouse
service:
  # Тип Service (ClusterIP для внутреннего доступа, LoadBalancer/NodePort для внешнего)
  type: ClusterIP
  # Порт HTTP интерфейса ClickHouse (для запросов через HTTP)
  httpPort: 8123
  # Порт native протокола ClickHouse (для native клиентов, более быстрый)
  nativePort: 9000

# Параметры узла (nodeSelector для привязки Pod к конкретному узлу)
nodeSelector: {}

# Толерации для развёртывания на узлах с taints
tolerations: []

# Affinity-правила для распределения Pod
affinity: {}

# Параметры пользователей ClickHouse
# Список пользователей с паролями для доступа к БД
users:
  # Пользователь default — встроенный пользователь ClickHouse
  - name: default
    password: "changeme123"
    # Квота на количество запросов (0 = без ограничений)
    quota: "default"
  # Дополнительный пользователь для приложения
  - name: app_user
    password: "app_secure_password_456"
    quota: "default"
  # Пользователь для мониторинга
  - name: monitor_user
    password: "monitor_pass_789"
    quota: "default"

# Параметры конфигурации ClickHouse
clickhouseConfig:
  # Максимальное количество одновременных соединений
  maxConnections: 4096
  # Максимальное количество одновременных запросов
  maxConcurrentQueries: 100
  # Путь для логов в контейнере
  logPath: /var/log/clickhouse-server/

# Параметры для проверки доступности Pod (liveness и readiness probes)
healthcheck:
  # Начальная задержка перед первой проверкой (в секундах)
  initialDelaySeconds: 30
  # Период между проверками (в секундах)
  periodSeconds: 10
  # Timeout одной проверки (в секундах)
  timeoutSeconds: 5
  # Количество неудачных проверок, после которого Pod рестартнёт
  failureThreshold: 3
